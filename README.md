# Py-Port-Scanner

Py-Port-Scanner is a simple app that scans open ports on a target host or CIDR block and classifies their severity based on predefined rules. The application consists of two main parts:

1. **Scanner**: Scans the target host for open ports and sends the results to the receiver.
2. **Receiver**: Receives scan results via HTTP, processes the data, and stores in a persistent format (json).

---

## Prerequisites

Ensure you have the following installed:

- Python 3.7+
- Required Python libraries:
  - `python-nmap`
  - `requests`

You can install the dependencies using the following command:
```bash
pip3 install -r requirements.txt
```
---

## How to Run Locally

### Running the Scanner

1. Edit the TARGETS variable in scanner.py, specify the target hosts you want to scan.
    ```python
    TARGETS = ["127.0.0.1"]  # Replace with your target IP addresses or CIDR blocks
    ```
2. Navigate to the project directory:
    ```bash
    cd /Users/lewismcdonald/Documents/GitHub/py-port-scanner
    ```
3. Run the scanner script with the target host or CIDR block as an argument:
    ```bash
    python3 scanner.py
    ```

### Running the Receiver

1. Start the receiver server:
    ```bash
    python3 receiver.py
    ```
2. The receiver will listen for incoming scan results on the configured HTTP port.

### Example Usage

1. Start the receiver in one terminal:
    ```bash
    sudo python3 receiver.py
    ```
2. Run the scanner in another terminal:
    ```bash
   sudo python3 scanner.py
    ```
3. View the results in the JSON file generated by the receiver, saved within receiver directory.

---

## Disclaimer

If you plan to deploy this application on AWS and use it to scan ports on AWS hosted infrastructure, you **must submit a penetration testing request to AWS**. Unauthorized port scanning is prohibited by AWS and may result in your account being flagged or suspended.

---

## Deployment

This application can be deployed serverless or using cloud infrastructure like EC2 instances, for simplicity this guide will explain deployment via EC2. 

### Receiver

The receiver will run on an EC2 instance and listen for incoming scan results.
1. Launch an EC2 instance in the AWS console with a Linux based AMI, with the required security group rules configured, such as allow inbound port 22 for SSH and inbound 5001 for HTTP requests.
2. Connect to the instance via SSH.
3. Install scanner dependencies: python3, pip, nmap
4. Clone Git repository: https://github.com/lewismcd1/py-port-scanner.git
5. Install Python dependencies:
        ```bash
        pip3 install -r requirements.txt
        ```
6. Start the receiver

### Scanner

The scanner will run on a separate EC2 instance and send scan results to the receiver.
 
1. Launch an EC2 instance in the AWS console with a Linux based AMI, with the required security group rules configured, such as allow inbound port 22 for SSH.
2. Connect to the instance via SSH.
3. Install scanner dependencies: python3, pip, nmap
4. Clone Git repository: https://github.com/lewismcd1/py-port-scanner.git
5. Install Python dependencies:
        ```bash
        pip3 install -r requirements.txt
        ```
6. Update scanner.py configuration to point RECEIVER_URL to the receiver EC2 instance, and TARGETS to the required scanning target IP address or CIDR block
        ```python
        RECEIVER_URL = "http://<RECEIVER_IP>:5001/report"
        TARGETS = ["<target-ip-or-cidr>"]
        ```
7. [optional] Create a cron job to automatically run the scanner on a schedule.

## Enhancements

### **1. Implemenent as a serverless application**
- **Objective**: Eliminate the need for EC2 instances by leveraging AWS serverless services.
- **Implementation**:
  - Deploy the **scanner** as an AWS Lambda function triggered by a schedule (e.g., using Amazon EventBridge).
  - Deploy the **receiver** as another Lambda function integrated with API Gateway to handle incoming scan results.

### **2. Store Results in Amazon DynamoDB**
- **Objective**: Use a managed database to store scan results, to make it easier to implement additional configuration, such as alerting.
- **Implementation**:
  - Replace the JSON file storage in the receiver with **Amazon DynamoDB**.
  - Store each scan result as a record in a DynamoDB table with attributes such as:
    - `alert_id`: Unique identifier
    - `host`: The scanned host.
    - `timestamp`: The time of the scan/alert.
    - `severity`: The highest severity level detected.
    - `open_ports`: A list of open ports.
  - Use DynamoDB queries to retrieve results based on alert_id, host, severity, or time range.

### **3. Add Email Alerts with Amazon SES**
- **Objective**: Send email alerts to relevant contact for the host.
- **Implementation**:
  - Integrate an additional processing lambda with SNS/SQS/SES.
  - When an alert is created in DynamoDB, use SNS to send to an SQS queue and alert using SES.
  - Example Workflow:
    1. A new alert record is created in the DB.
    2. The lambda processes this and formats an email alert.
    3. It sends the email using SES to a predefined list of recipients.

### **4. Secure HTTP Requests with HTTPS**
- **Objective**: Encrypt communication between the scanner and receiver to prevent eavesdropping and ensure data integrity.
- **Implementation**:
  - Use **AWS API Gateway** to create a secure HTTPS endpoint for the receiver.
  - Integrate the API Gateway with the receiver backend (Lambda or EC2).
  - Use **AWS Certificate Manager (ACM)** to attach an SSL/TLS certificate to the API Gateway.
  - Update the `RECEIVER_URL` in `scanner.py` to use the API Gateway HTTPS endpoint.
  - [Optional] Add authentication using API Keys or AWS IAM.

### **5. Reporting**
- **Objective**: Build reporting mechanism to allow hollistic view of open/closed alerts.
- **Implementation**: 
    - Send data to Azure tables from DynamoDB using a mixture of AWS Glue/Step Functions
    - Create data source from azure tables to use in PowerBI
    - Create a user friendly dashboard, with filters etc.
    
### **6. Integrate with a Vulnerability Management Tool**
- **Objective**: Enhance the scanner's functionality by linking it with a vulnerability management tool to provide detailed insights into the detected open ports.
- **Implementation**:
  - Use tools like **Nessus** or **Qualys** to perform vulnerability assessments on the scanned hosts.
  - After scanning, send the list of open ports to the vulnerability tool's API for further analysis.
  - Retrieve vulnerability reports and correlate them with the scan results to provide a comprehensive risk assessment.
  - Example Workflow:
    1. The scanner identifies open ports on a target host.
    2. The list of open ports is sent to the vulnerability tool for analysis.
    3. The receiver processes the vulnerability report and stores it alongside the scan results.
    4. Generate alerts or reports based on the combined data from the scanner and the vulnerability tool.